<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GPU Cloud Platform - User Guide</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" /> -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --accent-color: #667eea;
      --code-bg: #2d2d2d;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.7;
      color: #333;
    }
    
    .hero {
      background: var(--primary-gradient);
      color: white;
      padding: 4rem 0;
      margin-bottom: 3rem;
    }
    
    .hero h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }
    
    .sidebar {
      position: sticky;
      top: 20px;
      max-height: calc(100vh - 40px);
      overflow-y: auto;
      padding-right: 1rem;
    }
    
    .sidebar .nav-link {
      color: #666;
      padding: 0.5rem 1rem;
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }
    
    .sidebar .nav-link:hover {
      color: var(--accent-color);
      border-left-color: var(--accent-color);
      background: #f8f9fa;
    }
    
    .sidebar .nav-link.active {
      color: var(--accent-color);
      border-left-color: var(--accent-color);
      font-weight: 600;
    }
    
    .content-section {
      scroll-margin-top: 20px;
      margin-bottom: 3rem;
    }
    
    .content-section h2 {
      color: #2d3748;
      font-weight: 700;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 3px solid var(--accent-color);
    }
    
    .content-section h3 {
      color: #4a5568;
      font-weight: 600;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    
    .tip-box, .warning-box, .example-box {
      padding: 1.5rem;
      border-radius: 8px;
      margin: 1.5rem 0;
      border-left: 4px solid;
    }
    
    .tip-box {
      background: #e6f7ff;
      border-color: #1890ff;
    }
    
    .warning-box {
      background: #fff7e6;
      border-color: #fa8c16;
    }
    
    .example-box {
      background: #f6ffed;
      border-color: #52c41a;
    }
    
    .tip-box h4, .warning-box h4, .example-box h4 {
      margin-top: 0;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }

    .command-block pre {
      margin: 0 !important;
    } 
    
    .command-block {
      background: var(--code-bg);
      color: #f8f8f2;
      /* padding: 1rem; */
      padding: 0rem 1rem;
      border-radius: 6px;
      overflow-x: auto;
      margin: 1rem 0;
      position: relative;
    }
    
    .command-block code {
      color: inherit;
      background: none;
    }

    .copy-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.25rem 0.75rem;
      font-size: 0.75rem;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    
    .copy-btn:hover {
      opacity: 1;
    }
    
    .workflow-step {
      display: flex;
      align-items: start;
      margin-bottom: 1.5rem;
    }
    
    .workflow-number {
      background: var(--primary-gradient);
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      flex-shrink: 0;
      margin-right: 1rem;
    }
    
    .checklist {
      list-style: none;
      padding-left: 0;
    }
    
    .checklist li {
      padding: 0.5rem 0;
      padding-left: 2rem;
      position: relative;
    }
    
    .checklist li:before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #52c41a;
      font-weight: bold;
      font-size: 1.2rem;
    }
    
    .command-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      margin: 1.5rem 0;
    }
    
    .command-card {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 6px;
      padding: 1rem;
    }
    
    .command-card h5 {
      font-size: 0.9rem;
      color: var(--accent-color);
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    
    .badge-custom {
      background: var(--primary-gradient);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    details summary {
      cursor: pointer;
      padding: 0.75rem;
      background: #f8f9fa;
      border-radius: 6px;
      user-select: none;
    }
    
    details summary:hover {
      background: #e9ecef;
    }
    
    @media (max-width: 992px) {
      .sidebar {
        position: static;
        max-height: none;
        margin-bottom: 2rem;
      }
    }
  </style>
</head>
<body>

<!-- Prism stuffs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>

<!-- Hero Section -->
<div class="hero">
  <div class="container">
    <h1>üöÄ GPU Cloud Platform - RCCG</h1>
    <p class="lead mb-0">Complete user guide for research teams managing GPU VMs, volumes, and storage</p>
  </div>
</div>

<div class="container">
  <div class="row">
    <!-- Sidebar Navigation -->
    <div class="col-lg-3">
      <nav class="sidebar">
        <div class="nav flex-column">
          <a class="nav-link active" href="#section-1">1. Project Setup & Teams</a>
          <a class="nav-link" href="#section-2">2. Creating VMs</a>
          <a class="nav-link" href="#section-3">3. SSH access to VMs</a>
          <a class="nav-link" href="#section-4">4. Uploading Data</a>
          <a class="nav-link" href="#section-5">5. Software Stack</a>
          <a class="nav-link" href="#section-6">6. Running Simulations</a>
          <a class="nav-link" href="#section-7">7. Downloading Results</a>
          <a class="nav-link" href="#section-8">8. Storage Management</a>
          <a class="nav-link" href="#section-9">9. VM Lifecycle</a>
          <a class="nav-link" href="#section-10">10. Budget Tips</a>
          <a class="nav-link" href="#section-11">11. Best Practices</a>
          <a class="nav-link" href="#quick-ref">Quick Reference</a>
        </div>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="col-lg-9">
      
      <!-- Section 1 -->
      <section id="section-1" class="content-section">
        <h2>1. Project Setup & Team Management</h2>
        
        <h3>Quick Workflow</h3>
        <div class="workflow-step">
          <div class="workflow-number">1</div>
          <div>
            <strong>Project Awarded</strong>
            <p>If you are the PI of this project, Administrator marks your account as Project Owner in the application</p>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="workflow-number">2</div>
          <div>
            <strong>Owner Setup</strong>
            <p>Sign up (or Sign in), and verify your Project Details </p>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="workflow-number">3</div>
          <div>
            <strong>Add Team Members</strong>
            <p>Add collaborators as "Project Members" through Project ‚Üí "Manage Team"</p>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="workflow-number">4</div>
          <div>
            <strong>Team Access</strong>
            <p>Members must first Sign Up</p>
            <p>Members shall then generate and import their ssh key into their GPU Cloud environment, then they will gain access to project resources</p>
          </div>
        </div>

        <div class="tip-box">
          <h4>üí° Practical Tips</h4>
          <ul>
            <li>Project Owner is in charge of monitoring credit usage</li>
            <li>Project Owner is in charge of the SSH key of the project, he must not distribute it to anyone</li>
            <li>After VM creation, any Project Member can import his own SSH keys directly to specific VMs via the "Import SSH Key" button</li>
            <li>Imported keys are automatically added to the VM's authorized_keys file enabling passwordless access to the Project Member</li>
          </ul>
        </div>

        <div class="example-box">
          <h4>üìã Example: Owner Adding Teammates</h4>
          <ol>
            <li>Navigate to <strong>Project ‚Üí Manage Team</strong></li>
            <li>Click "Add Member" and enter teammate's email</li>
            <li>Assign role (Member / Manager)</li>
            <li>Instruct teammates: "Sign up with the same email"</li>
          </ol>
        </div>
      </section>

      <!-- Section 2 -->
      <section id="section-2" class="content-section">
        <h2>2. Creating a VM: Choosing Flavor & Base Image</h2>
        
        <h3>What to Consider</h3>
        
        <div class="row mb-3">
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">üéÆ GPU Model</h5>
                <p class="card-text">Different GPUs have varying memory, compute power, and pricing. Match to your workload:</p>
                <ul class="small">
                  <li><strong>Large NLP models:</strong> High VRAM GPUs (A100, H100)</li>
                  <li><strong>Small experiments:</strong> Cheaper GPUs (A100 PCIe)</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">üíæ vCPU & RAM</h5>
                <p class="card-text">CPU and memory matter for:</p>
                <ul class="small">
                  <li>Data preprocessing</li>
                  <li>I/O operations</li>
                  <li>Multi-process workflows</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <h3>Hardware Flavor details</h3>
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="table-light">
                <tr>
                  <th>Tier</th>
                  <th>GPU(s)</th>
                  <th>GPU RAM</th>
                  <th>CPU(s)</th>
                  <th>CPU RAM</th>
                  <th>Storage</th>
                  <th>Cost (USD/h)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>CPU Only</strong></td>
                  <td>N.A.</td>
                  <td>N.A.</td>
                  <td>1 vCPU</td>
                  <td>4GB</td>
                  <td>100GB NVMe</td>
                  <td>0.3484</td>
                </tr>
                <tr>
                  <td><strong>A100 GPU PCIe</strong></td>
                  <td>1√óA100</td>
                  <td>80GB</td>
                  <td>28 vCPU</td>
                  <td>120GB</td>
                  <td>100GB NVMe + 750GB ephemeral</td>
                  <td>1.35</td>
                </tr>
                <tr>
                  <td><strong>H100 GPU PCIe</strong></td>
                  <td>1√óH100</td>
                  <td>80GB</td>
                  <td>28 vCPU</td>
                  <td>180GB</td>
                  <td>100GB NVMe + 750GB ephemeral</td>
                  <td>1.9</td>
                </tr>
                <tr>
                  <td><strong>4*H100 GPU PCIe</strong></td>
                  <td>4√óH100</td>
                  <td>4x80GB</td>
                  <td>124 vCPU</td>
                  <td>720GB</td>
                  <td>100GB NVMe + 3.2TB ephemeral</td>
                  <td>7.6</td>
                </tr>
                <tr>
                  <td><strong>8*H100 GPU PCIe</strong></td>
                  <td>8√óH100</td>
                  <td>8x80GB</td>
                  <td>252 vCPU</td>
                  <td>1440GB</td>
                  <td>100GB NVMe + 6.5TB ephemeral</td>
                  <td>15.2</td>
                </tr>
              </tbody>
            </table>
          </div>

        <h3>Disk Types Explained</h3>
        <div class="command-grid">
          <div class="command-card">
            <h5>üìÅ Root Disk (OS)</h5>
            <p class="small mb-0">Persistent while instance exists. Small by default. Use for OS and configurations. Can be used for Software and/or Data if small enough.</p>
          </div>
          <div class="command-card">
            <h5>‚ö° Ephemeral Disk</h5>
            <p class="small mb-0">Fast local disk, deleted on termination. Perfect for temporary scratch files and fast I/O.</p>
          </div>
          <div class="command-card">
            <h5>üíΩ Persistent Volume</h5>
            <p class="small mb-0">Attach/detach across VMs. Survives VM deletion. Best for datasets and outputs.</p>
          </div>
        </div>

        <div class="tip-box">
          <h4>üéØ Rule of Thumb</h4>
          <ul class="mb-0">
            <li><strong>Rapid prototyping/debugging:</strong>CPU Only VM or Single A100 GPU VM</li>
            <li><strong>Real training runs:</strong> Match GPU memory to model size; add enough CPU/RAM for data staging</li>
            <li><strong>Data transfer:</strong> Use CPU Only VM as staging VM (cheaper) + volume to avoid wasting expensive GPU hours</li>
          </ul>
        </div>

        <h3>Creating VM from the UI</h3>
        <ol>
          <li>Navigate to <strong>Project Panel ‚Üí Create VM</strong></li>
          <li>Enter VM name</li>
          <li>Select <strong>Hardware Flavor</strong> (choose GPU type)</li>
          <li>Select <strong>Base Image</strong> (see golden images below)</li>
          <li>Click <strong>Create GPU VM</strong></li>
        </ol>
      </section>

      <!-- Section 3 -->
      <section id="section-3" class="content-section">
        <h2>3. üîëSSH access to VMs</h2>

      <div class="command-card">
        <p class="small mb-0">üë®‚Äçüíº Project Owner can ignore this section as he possesses the "Project Master Key".</p>
      </div>
       <p class="mb-0 mt-0"><strong>As a Project Member, to access any VM, you first need to:</strong></p>
        <ol class="mb-0 mt-0">
          <li>Generate your own SSH key pair</li>
            <div class="command-block">
              <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
              <pre><code class="language-bash"># From your local Linux machine
ssh-keygen -t ed25519 -f ~/.ssh/my_ssh_key
# Restrict accesss to your private key
chmod 600 ~/.ssh/my_ssh_key</code></pre>
            </div>
            <div class="tip-box">
              <h4>üí° You can also create your ssh key on Windows</h4>
              <ul class="mb-0">
                <li><strong>via WSL</strong></li>
                <ul class="mb-0">
                  <li>Same as in Linux (see commands above) </li>
                  <li>But make sure you are on the WSL native filesystem like <code>~/</code> because permission restriction won't work in Windows filesystem <code>(/mnt/c/...)</code></li>
                </ul>
                <li><strong>via Powershell</strong></li>
                <ul class="mb-0">
                  <li>Use <code>ssh-keygen -t ed25519 -f $env:USERPROFILE\.ssh\my_ssh_key</code> to generate the key pair </li>
                  <li>Use <code>icacls $env:USERPROFILE\.ssh\my_ssh_key /inheritance:r</code></li>
                  <li>And <code>icacls $env:USERPROFILE\.ssh\my_ssh_key /grant:r "$env:USERNAME:R"</code> to restrict permission</li>
                </ul>
              </ul>
            </div>
             <div>
                <li>The <code>ssh-keygen</code> command will generate 2 elements:</li>
                <ol class="mb-0">
                  <li>A public key, named <code>my_ssh_key.pub</code> </li>
                  <li>Its related private key, named <code>my_ssh_key</code> </li>
                  <li>Both files will be saved in the directory where the command was executed (in our case: <code>~/.ssh/</code>)</li>
                </ol>
             </div>
            <div>üí°This step is required to be performed only one time per project as you can re-use the same key for all VMs</div>
          <li>Import the public part of this key pair (aka your public key) to the VM you want to access:</li>
            <ol class="mb-0">
              <li>In the "Manage VMs" page, select the VM you want to ssh into</li>
              <li>In the "Details" panel, click on "‚ûïüîêImport my SSH public key" button</li>
              <li>Paste the content of your public key (my_ssh_key.pub) into the Import SSH Key dialog and click "import"</li>
              <li>‚ö†Ô∏èWarning: don't paste the content of your private key (my_ssh_key), this should never be disclosed</li>
            </ol>
            <div>üí°This step is required to be performed for each VM you want to access</div>
          <li>Then you can access your VM through the <strong>SSH Command</strong> by pointing to the path of your private ssh key:</li>
            <div class="command-block">
              <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
              <pre><code class="language-bash"># From your local Linux machine
ssh -i ~/.ssh/my_ssh_key ubuntu@&lt;GPU_VM_IP&gt;</code></pre>
            </div>
            <div>
              <p class="mt-2 mb-0"><strong>Alternative: Use MobaXterm (Windows):</strong></p>
                <ol class="mb-0">
                  <li>Create new SSH session</li>
                  <li>Enter VM IP address</li>
                  <li>Specify username</li>
                  <li>Use private key authentication (in "Advanced SSH settings")</li>
                  <li>Save session for future use</li>
                </ol>
            </div>
            <div>üí°More Details here: <a href="https://rccg.hbku.edu.qa/wiki/Soft_mobaxterm" target="_blank">RCCG MobaXterm</a></div>
        </ol>
      </section>

<h4>Summary</h4>
<p>Project Member can import additional SSH keys to an existing VM at any time:</p>

<div class="workflow-step">
  <div class="workflow-number">0</div>
  <div>
    <strong>Generate your own ssh-key pair</strong>
    <p>Using <code>ssh-keygen</code> command. May be ignored if you already have your ssh key</p>
  </div>
</div>

<div class="workflow-step">
  <div class="workflow-number">1</div>
  <div>
    <strong>Navigate to VM Details</strong>
    <p>Go to Manage VMs page ‚Üí Your VM ‚Üí Click on VM name to view details</p>
  </div>
</div>

<div class="workflow-step">
  <div class="workflow-number">2</div>
  <div>
    <strong>Click "‚ûïüîêImport my SSH public key"</strong>
    <p>This option is only available for "Running" VMs</p>
  </div>
</div>

<div class="workflow-step">
  <div class="workflow-number">3</div>
  <div>
    <strong>Paste Your Public Key</strong>
    <p>Paste the contents of your <code>~/.ssh/my_ssh_key.pub</code> file (or other public key)</p>
  </div>
</div>

<div class="workflow-step">
  <div class="workflow-number">4</div>
  <div>
    <strong>Click on "Import" button</strong>
    <p>The key will be automatically added to <code>~/.ssh/authorized_keys</code> on the VM</p>
  </div>
</div>

<div class="warning-box">
  <h4>‚ö†Ô∏è Important</h4>
  <ul class="mb-0">
    <li>Only paste <strong>public keys</strong> (ending in .pub), never private keys</li>
    <li>Keys are appended to existing authorized_keys, not replaced</li>
    <li>Imported keys persist even after VM stop/restart</li>
    <li>If you lose access, contact RCCG support to reset VM access</li>
  </ul>
</div>

<h4>Finding Your SSH Public Key</h4>

<p>On your local machine (laptop/workstation):</p>

<div class="command-block">
  <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
  <pre><code class="language-bash"># View your public key (Linux/macOS)
cat ~/.ssh/my_ssh_key.pub

# Windows (PowerShell)
type $env:USERPROFILE\.ssh\my_ssh_key.pub

# If you don't have a key, generate one:
ssh-keygen -t ed25519 -f ~/.ssh/my_ssh_key</code></pre>
</div>

<div class="example-box">
  <h4>üìã Example SSH Public Key</h4>
  <p>Your public key looks like this (one long line):</p>
  <pre><code class="language-bash">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC7...</code></pre>
  <p class="mt-2 mb-0"><strong>Copy the entire line</strong> and paste it into the Import SSH Key dialog.</p>
</div>

      <!-- Section 4 -->
      <section id="section-4" class="content-section">
        <h2>4. Uploading Input Data (Use Volumes + Staging VM)</h2>
        
        <h3>Why Use a Staging VM?</h3>
        <p>GPU VMs are expensive per hour. Uploading large datasets directly wastes money. Instead:</p>
        <ol>
          <li>Create a CPU Only VM <strong>cheap CPU VM</strong></li>
          <li>Attach a persistent volume to it</li>
          <li>Upload data there</li>
          <li>Detach and attach volume to your GPU VM</li>
        </ol>

        <h3>Step-by-Step Scenario</h3>
        <div class="workflow-step">
          <div class="workflow-number">1</div>
          <div>Create a persistent volume (size = dataset + margin)</div>
        </div>
        <div class="workflow-step">
          <div class="workflow-number">2</div>
          <div>Create a staging VM (CPU Only)</div>
        </div>
        <div class="workflow-step">
          <div class="workflow-number">3</div>
          <div>Attach volume to staging VM via UI</div>
        </div>
        <div class="workflow-step">
          <div class="workflow-number">4</div>
          <div>SSH to staging VM and mount the volume</div>
        </div>
        <div class="workflow-step">
          <div class="workflow-number">5</div>
          <div>Upload data from laptop using rsync or scp</div>
        </div>
        <div class="workflow-step">
          <div class="workflow-number">6</div>
          <div>Safely unmount and detach the volume, then attach to GPU VM</div>
        </div>
        <div class="workflow-step">
          <div class="workflow-number">8</div>
          <div>Attach and mount the volume to your GPU VM</div>
        </div>

        <h3>Upload Commands (from your laptop)</h3>
        
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Using rsync (recommended - can resume, shows progress)
rsync -avz -P --checksum -e "ssh -i /path/to/ssh_private_key" ./dataset/ ubuntu@VM-IP:/mnt/my_volume/</code></pre>
        </div>
        <div class="tip-box">
          <h4>üí°Options</h4>
          <ul class="mb-0">
            <li><span class="badge bg-primary">-a</span>‚Üí archive mode: recursively copy everything, preserve timestamps, permissions, symlinks</li>
            <li><span class="badge bg-primary">-v</span>‚Üí verbose (optional but helpful)</li>
            <li><span class="badge bg-primary">-z</span>‚Üí compression (very useful for text, less useful for images or already-compressed data)</li>
            <li><span class="badge bg-primary">-P</span>‚Üí same as <code>--partial --progress</code>: allows resuming interupted file tranfer, from partially transferred file, and shows progress for each file</li>
            <li><span class="badge bg-primary">--checksum</span>‚Üí detects changes based on checksum, not only size+timestamp</li>
            <li><span class="badge bg-primary">-e "ssh -i /path/to/ssh_private_key"</span>‚Üí use SSH as the transport layer, and authenticate using this specific private key
          SSH key authentication ‚Üí secure, non-interactive</li>
          </ul>
        </div>

        <div class="warning-box">
          <h4>‚ö†Ô∏è When <span class="badge bg-primary">--checksum</span> may be overkill</h4>
          <span>It forces rsync to read every file on both sides, even if unchanged.</span>
          <span>For large datasets (1M+ files, multi-TB), it can slow things down.</span>
          <span>But for ML datasets smaller than a few hundred GB, it‚Äôs fine.</span>
        </div>

        <div class="example-box">
          <h4>üöÄ Faster transfers => disable compression (i.e. don't use <span class="badge bg-primary">-z</span>) for already-compressed data</h4>
          <span>Typically when datasets contain images, videos, archives </span>
        </div>

        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Using scp (simpler, but less resume-friendly)
scp -r ./dataset ubuntu@VM-IP/mnt/my_volume/</code></pre>
        </div>

        <h3>Safe Detach Procedure</h3>
        <p>On the staging VM, before detaching in UI:</p>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Flush writes and unmount
sync
sudo umount /mnt/volume

# Verify unmounted
lsblk
findmnt</code></pre>
        </div>
        <p>Then use UI to <strong>detach volume</strong> and <strong>attach to GPU VM</strong></p>
      </section>

      <!-- Section 5 - UPDATED WITH RCCG INFO -->
      <section id="section-5" class="content-section">
        <h2>5. Preparing the Software Stack</h2>
        
        <h3>Choosing Your Base Image</h3>
        <p>RCCG provides four pre-configured golden images to quickly start work:</p>
        
        <table class="table table-bordered table-striped">
          <thead class="table-light">
            <tr>
              <th>Image Name</th>
              <th>Description</th>
              <th>Best For</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Ubuntu 22.04 LTS</strong></td>
              <td>Clean system with no extra libraries</td>
              <td>Custom setups, full control</td>
            </tr>
            <tr>
              <td><strong>Ubuntu 22.04 + CUDA 12.2</strong></td>
              <td>CUDA toolkit pre-installed</td>
              <td>GPU compute, custom ML environments</td>
            </tr>
            <tr>
              <td><strong>minimal-research-base-image</strong></td>
              <td>Lightweight research environment with scientific Python packages, HDF5, NetCDF, JupyterLab</td>
              <td>Scientific computing, data analysis</td>
            </tr>
            <tr>
              <td><strong>ml-dl-gpu-base-image</strong></td>
              <td>Full ML/DL environment with PyTorch 2.5.1, TensorFlow 2.14, cuDNN, NCCL</td>
              <td>Deep learning, neural networks</td>
            </tr>
          </tbody>
        </table>

        <div class="tip-box">
          <h4>üí° Quick Selection Guide</h4>
          <ul class="mb-0">
            <li><strong>Deep Learning:</strong> Use <code>ml-dl-gpu-base-image</code> - comes with PyTorch, TensorFlow, and all ML libraries</li>
            <li><strong>Scientific Computing:</strong> Use <code>minimal-research-base-image</code> - includes HDF5, NetCDF, JupyterLab</li>
            <li><strong>Custom Setup:</strong> Start with <code>Ubuntu 22.04 + CUDA 12.2</code></li>
          </ul>
        </div>

        <details class="mt-3 mb-3">
          <summary class="btn btn-outline-primary btn-sm">üìã View Complete Software Comparison Table</summary>
          <div class="mt-3">
            <table class="table table-sm table-bordered">
              <thead class="table-light">
                <tr>
                  <th>Software Package</th>
                  <th>Ubuntu 22.04</th>
                  <th>Ubuntu + CUDA</th>
                  <th>Minimal Research</th>
                  <th>ML-DL GPU</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>Python 3.11</td><td>‚úÖ</td><td>‚úÖ</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>CUDA 12.2</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>Anaconda 2024.11</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>Environment Modules 4.8.2</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>GDB 13.2</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>CMake 3.27.7</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>HDF5 1.14.2</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>NetCDF 4.9.3</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>SingularityCE 1.3.0</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>OpenMPI 5.1.0</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>JupyterLab 4.2.3</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td>Git 2.34.1</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td><td>‚úÖ</td></tr>
                <tr><td><strong>PyTorch 2.5.1</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>TensorFlow 2.14</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>cuDNN 8.9</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>NCCL 2.27</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>scikit-learn 1.5.2</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>NumPy 1.25</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>SciPy 1.14</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>Pandas 2.2</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
                <tr><td><strong>Matplotlib 3.10</strong></td><td>‚ùå</td><td>‚ùå</td><td>‚ùå</td><td>‚úÖ</td></tr>
              </tbody>
            </table>
          </div>
        </details>

        <h3>SSH Access to Your VM</h3>
        
        <h4>Option 1: Command Line SSH</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># SSH with private key
ssh -i /path/to/my_ssh_private_key ubuntu@&lt;User_VM_IP&gt;
# Example
ssh -i ~/.ssh/my_private_key ubuntu@192.168.1.100</code></pre>
        </div>


        <h4>Option 2: MobaXterm (Windows Users)</h4>
        <p>Setup a persistent SSH session in MobaXterm for easier access. This allows you to save your connection settings and access your VM with one click.</p>
        <p>For more details on setting up a SSH session using MobaXterm, visit: 
            <a href="https://rccg.hbku.edu.qa/wiki/Soft_mobaxterm" target="_blank"> RCCG MobaXterm</a>
        </p>

        <div class="tip-box">
          <h4>üí°Pro Tips</h4>
          <ul class="mb-0">
            <li>Both Options require the VM to be configured with your SSH key</li>
            <li>To perform this configuration, please refer to <a href="#section-3">3. SSH access to VMs</a> section</li>
          </ul>
        </div>

        <h3>A. Using Pre-installed Software (Environment Modules)</h3>
        <p>All research base images come with Environment Modules for easy package management:</p>
        
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># List available software packages
module avail

# Output shows:
# ------------------------------------------- /opt/modulefiles --------------------------------------------
# anaconda3/2024.02-1  cmake/3.27.7  conda_hdf5  conda_netcdf4  conda_python  
# gdb/13.2  go/1.25  ml_dl_gpu_base_all  openmpi/4.1.6  python/3.11  singularityce/4.3.3</code></pre>
        </div>

        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Load required modules (always start with anaconda3)
module load anaconda3/2024.02-1
module load openmpi/4.1.6

# For ML/DL work, load the complete ML stack
module load ml_dl_gpu_base_all

# This single module loads ALL of:
# - PyTorch 2.5.1
# - TensorFlow 2.14
# - cuDNN 8.9
# - scikit-learn 1.5.2
# - NCCL 2.27
# - NumPy 1.25
# - SciPy 1.14
# - Pandas 2.2
# - Matplotlib 3.10

# Verify loaded modules
module list</code></pre>
        </div>

        <div class="warning-box">
          <h4>‚ö†Ô∏è Important</h4>
          <p class="mb-0">Always load <code>anaconda3/2024.02-1</code> first before loading other modules. This ensures proper Python environment initialization.</p>
        </div>

        <h3>B. Installing Additional Packages</h3>
        <p>You have root privileges on your VM and can install additional software via apt, conda, pip, or source compilation:</p>
        <p>Before installing additional packages via Conda or Pip, you can have a look at this RCCG article: 
            <a href="https://rccg.hbku.edu.qa/wiki/Python_package_management" target="_blank"> Python Package Management</a>
        </p>

        <h4>Via Conda (Recommended)</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Create a new Conda environment
conda create -n my_conda_env python=3.11 -y

# Activate the environment
conda activate my_conda_env

# Install packages via conda
conda install -c conda-forge scikit-image -y

# Or via pip
pip install transformers datasets

# Example: Install RAPIDS for GPU-accelerated data science
conda install -c rapidsai -c nvidia -c conda-forge \
    rapids=24.06 \
    cudatoolkit=12.2 \
    -y</code></pre>
        </div>

        <h4>Via APT (System Packages)</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Update package list
sudo apt update

# Install system packages
sudo apt install htop vim tmux -y</code></pre>
        </div>

        <h3>C. Using Containers with Docker</h3>
        <div class="tip-box">
          <h4>‚ö°<strong>Container X GPU Cloud</strong></h4>
          <ul class="mb-0">
            <li>In a <strong>GPU cloud environment</strong>, users often run complex scientific or machine-learning apps that depend on specific versions of CUDA, libraries, compilers, or OS packages.</li>
            <li>Re-creating these environments manually on every VM is time-consuming and error-prone.</li>
            <li><strong>Docker</strong> solves this: a container acts like a portable, self-contained execution environment that always behaves the same, no matter which VM it runs on. This ensures:</li>
            <ul class="mb-0">
              <li><strong>Reproducibility:</strong> Your application runs identically across VMs.</li>
              <li><strong>Portability:</strong> Move your app between your laptop, the GPU cloud, other clusters, etc.</li>
              <li><strong>Isolation:</strong> Avoid conflicting dependencies or system-level failures.</li>
              <li><strong>Performance:</strong> NVIDIA supports GPU pass-through for containers with almost zero overhead.</li>
            </ul>
            <li>For GPU workloads specifically, Docker integrates with the NVIDIA Container Runtime, which exposes the GPUs safely and efficiently to the container.</li>
            <li>Docker is pre-installed on all base images for running containerized applications.</li>
          </ul>
        </div>
  
        <h4>Best practice: use an official container from NVIDIA NGC</h4>
        <p>Before building anything yourself, check NVIDIA GPU Cloud (NGC), which hosts official, optimized, GPU-ready containers for major scientific and AI applications:
        NAMD, GROMACS, OpenMM, TensorFlow, PyTorch, and many others.</p>
        <h5>How to find the right container</h5>
        <ol class="mb-0">
          <li>Visit: <a href="https://catalog.ngc.nvidia.com" target="_blank">NVIDIA NGC Catalog</a> </li>
          <li>Search for your application (e.g., ‚Äúnamd‚Äù)</li>
          <li>Open the container page and copy the pull command</li>
          <li>For example, for NAMD 3.0.1:
            <pre><code class="language-bash">docker pull nvcr.io/hpc/namd:3.0.1</code></pre>
          </li>
        </ol>

        <h4>Example workflow using an NGC container (NAMD)</h4>
        <p>Once your GPU VM is created and you're connected via SSH, this is the typical pattern:</p>

        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># 1. Pull the container
docker pull nvcr.io/hpc/namd:3.0.1

# 2. Download example input files
mkdir namd_workspace
cd namd_workspace/
wget -O - https://gitlab.com/NVHPC/ngc-examples/raw/master/namd/3.0/get_apoa1.sh | bash

# 3. Prepare the output directory
mkdir apoa1/output

# 4. Edit the configuration file
#Inside apoa1/apoa1.namd, set:
outputname output/apoa1

# 5. Run NAMD inside the NGC container
export NAMD_EXE=namd3
export NAMD_TAG=3.0.1
docker run --rm --runtime=nvidia --gpus all --ipc=host -v $PWD:/namd_workspace/apoa1 \
 -w /namd_workspace/apoa1 nvcr.io/hpc/namd:$NAMD_TAG ${NAMD_EXE} \ 
 +p28 +devices 0 +setcpuaffinity ./apoa1/apoa1.namd

# Options explanation:
--rm ‚Üí Automatically remove the container when finished
--runtime=nvidia --gpus all ‚Üí Give container access to all GPUs
--ipc=host ‚Üí Enable proper inter-process communication for MPI / multicore execution
-v $PWD:/namd_workspace/apoa1 ‚Üí Mount the host folder into the container
-w /namd_workspace/apoa1 ‚Üí Set the container‚Äôs working directory
+p28 ‚Üí Use 28 CPU threads (adjust depending on your VM)
+devices 0 ‚Üí Use GPU 0 (if you have 4 GPUS, you can do +devices 0,1,2,3)
+setcpuaffinity ‚Üí Bind CPU threads to physical cores for performance
./apoa1/apoa1.namd ‚Üí NAMD input file to run

# 6. Display output file :
cat apoa1/output/apoa1.xsc</code></pre>
        </div>

        <h4>If no suitable NGC container exists: building your own</h4>

        <p>Sometimes your application is not available on NGC, or you need custom dependencies.
        In such cases, you will build your own image locally, i.e. on your local laptop/desktop and then transfer it to your GPU VM.
        You do not need Docker Hub or any external registry.</p>
        <h6>1. Build the image on your local machine</h6>
          <ul class="mb-0">
          <li>Example Dockerfile for a custom NAMD build:
            <pre><code class="language-bash">FROM nvidia/cuda:12.2.0-devel
RUN apt-get update && apt-get install -y build-essential tcl-dev wget
RUN wget https://www.ks.uiuc.edu/Research/namd/3.0/download/...
RUN tar xvf namd.tar.gz
RUN cd namd && make -j install</code></pre>
          </li>
          <li>Build this image in your local laptop with: <pre><code class="language-bash">docker build -t my_namd_custom:1.0 .</code></pre></li>
        </ul>
        <h6>2. Save the image to a tar file</h6>
        <ul class="mb-0">
          <li><pre><code class="language-bash">docker save my_namd_custom:1.0 -o namd_custom.tar</code></pre></li>
          <li>You can compress it further with gzip if needed</li>
        </ul>
        <h6>3. Transfer the tar file from your laptop to the GPU VM</h6>
        <ul class="mb-0">
          <li>Use scp, rsync, or any secure file transfer method</li>
          <li><pre><code class="language-bash">scp -i your_key.pem namd_custom.tar ubuntu@GPU_VM_IP:/home/ubuntu/</code></pre></li>
        </ul>
        <h6>4. Import (load) the image on the GPU VM</h6>
        <ul class="mb-0">
          <li>ssh into your GPU VM</li>
          <li><pre><code class="language-bash">docker load -i namd_custom.tar</code></pre></li>
        </ul>
        <h6>6. Run your custom container</h6>
        <ul class="mb-0">
          <li><pre><code class="language-bash">docker run --rm --gpus all my_namd_custom:1.0 namd3 input.namd</code></pre></li>
          <li>"This commands means: Start a temporary container, give it access to all GPUs, run the namd3 executable using the configuration file input.namd, and delete the container once the job finishes."</li>
        </ul>

        <h3>D. Using Containers with SingularityCE</h3>
        <p>SingularityCE 1.3.0 is pre-installed on research base images for running containerized applications:</p>
        <p>Before using Singularity, you can have a look at this RCCG article: 
            <a href="https://rccg.hbku.edu.qa/wiki/Sing_Containers" target="_blank"> Singularity Containers</a>
        </p>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Pull a Docker container as Singularity image
singularity pull docker://pytorch/pytorch:2.5.1-cuda12.4-cudnn9-runtime

# Run with GPU support
singularity exec --nv pytorch_2.5.1-cuda12.4-cudnn9-runtime.sif python train.py

# Interactive shell in container
singularity shell --nv pytorch_2.5.1-cuda12.4-cudnn9-runtime.sif</code></pre>
        </div>

        <div class="tip-box">
          <h4>üí° Best Practices</h4>
          <ul class="mb-0">
            <li><strong>Start with modules:</strong> Use pre-installed modules via <code>module load</code> to save time</li>
            <li><strong>Use conda environments:</strong> Create isolated environments for different projects</li>
            <li><strong>Containers for reproducibility:</strong> Use SingularityCE for complex dependencies or reproducible experiments</li>
            <li><strong>Save environment specs:</strong> Export with <code>conda env export > environment.yml</code></li>
            <li><strong>Verify GPU access:</strong> Always check <code>nvidia-smi</code> after setup</li>
          </ul>
        </div>
      </section>

      <!-- Section 6 - UPDATED WITH RCCG INFO -->
      <section id="section-6" class="content-section">
        <h2>6. Running Your Simulation / Training</h2>
        
        <h3>Storage Best Practices</h3>
        <div class="row mb-3">
          <div class="col-md-6">
            <div class="card border-success h-100">
              <div class="card-body">
                <h5 class="card-title text-success">‚úÖ Persistent Volume</h5>
                <p class="card-text"><strong>Use for:</strong></p>
                <ul class="small mb-0">
                  <li>Input datasets</li>
                  <li><strong>Final simulation outputs</strong></li>
                  <li>Checkpoints</li>
                  <li>Any data you want to keep</li>
                  <li>Path: <code>/mnt/user_volume/</code></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card border-warning h-100">
              <div class="card-body">
                <h5 class="card-title text-warning">‚ö° Ephemeral Storage</h5>
                <p class="card-text"><strong>Use for:</strong></p>
                <ul class="small mb-0">
                  <li>Temporary files</li>
                  <li>Intermediate results</li>
                  <li>Scratch data</li>
                  <li>Cache files</li>
                  <li><strong>‚ö†Ô∏è Deleted on VM termination!</strong></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="warning-box">
          <h4>‚ö†Ô∏è Critical: Data Persistence</h4>
          <ul class="mb-0">
            <li><strong>Always save final outputs to the mounted volume</strong> (e.g., <code>/mnt/user_volume/</code>)</li>
            <li>Ephemeral storage is <strong>deleted when VM is terminated</strong></li>
            <li>Copy important results from ephemeral to volume before stopping/deleting VM</li>
          </ul>
        </div>

        <h3>Session Management (Critical!)</h3>
        <p>Use <code>tmux</code> or <code>screen</code> to keep jobs running after disconnection:</p>
        
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Start new tmux session
tmux new -s simulation

# Inside tmux, load modules and run simulation
module load anaconda3/2024.02-1
module load ml_dl_gpu_base_all

# Run simulation with output to volume
python3 my_simulation_script.py > /mnt/user_volume/output.log 2>&1

# Or save results directly to volume
python3 train.py \
  --data /mnt/user_volume/datasets/ \
  --output /mnt/user_volume/results/ \
  --checkpoint-dir /mnt/user_volume/checkpoints/

# Detach from session (keeps running)
# Press: Ctrl-B, then D

# Re-attach later
tmux attach -t simulation</code></pre>
        </div>

        <div class="example-box">
          <h4>üìã Complete Simulation Example</h4>
          <div class="command-block">
            <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code class="language-bash"># 1. SSH to VM
ssh -i ~/.ssh/id_rsa ubuntu@192.168.1.100

# 2. Verify volume is mounted
df -h | grep volume
# Should show: /dev/sdb1  1.0T  100G  900G  10% /mnt/user_volume

# 3. Start tmux session
tmux new -s training

# 4. Load required modules
module load anaconda3/2024.02-1
module load ml_dl_gpu_base_all

# 5. Verify GPU is available
nvidia-smi

# 6. Run simulation (output to HDF5 on volume)
python3 my_simulation.py \
  --input /mnt/user_volume/datasets/input.nc \
  --output /mnt/user_volume/results/output.hdf5 \
  --epochs 100 \
  --batch-size 64 \
  2>&1 | tee /mnt/user_volume/logs/training.log

# 7. Detach: Ctrl-B, then D</code></pre>
          </div>
        </div>

        <h3>Optimal Performance Tips</h3>
        <ul class="checklist">
          <li><strong>Store persistent data on mounted volume</strong> (<code>/mnt/user_volume/</code>)</li>
          <li><strong>Use ephemeral storage for temporary files</strong> to reduce volume I/O</li>
          <li><strong>Copy final results to volume</strong> before VM deletion</li>
          <li><strong>Enable checkpointing</strong> in your code for long runs</li>
          <li><strong>Monitor GPU usage</strong> with <code>watch -n 2 nvidia-smi</code></li>
          <li><strong>Log outputs to volume</strong> so you can review them later</li>
        </ul>

        <h3>Monitoring Commands</h3>
        
        <div class="command-grid">
          <div class="command-card">
            <h5>üéÆ GPU Usage</h5>
            <div class="command-block mb-0" style="padding: 0.5rem;">
              <code class="language-bash">watch -n 2 nvidia-smi</code>
            </div>
          </div>
          <div class="command-card">
            <h5>üíª CPU/Memory</h5>
            <div class="command-block mb-0" style="padding: 0.5rem;">
              <code class="language-bash">htop
free -h</code>
            </div>
          </div>
          <div class="command-card">
            <h5>üíæ Disk I/O</h5>
            <div class="command-block mb-0" style="padding: 0.5rem;">
              <code class="language-bash">iostat -x 2
sudo iotop</code>
            </div>
          </div>
          <div class="command-card">
            <h5>üìä Volume Space</h5>
            <div class="command-block mb-0" style="padding: 0.5rem;">
              <code class="language-bash">df -h /mnt/user_volume
du -sh /mnt/user_volume/*</code>
            </div>
          </div>
        </div>

        <h3>Using JupyterLab (Research Base Images)</h3>
        <p>JupyterLab 4.2.3 is pre-installed on research base images:</p>
        
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Load anaconda module
module load anaconda3/2024.02-1

# Start JupyterLab (in tmux recommended)
jupyter lab --ip=0.0.0.0 --port=8888 --no-browser \
  --NotebookApp.token='your-secure-token'

# Access from your laptop via SSH tunnel:
# ssh -L 8888:localhost:8888 ubuntu@vm-ip
# Then open: http://localhost:8888</code>
        </div>

        <div class="tip-box">
          <h4>üí° Pro Tips</h4>
          <ul class="mb-0">
            <li>Always run simulations inside <code>tmux</code> or <code>screen</code></li>
            <li>Save intermediate checkpoints to volume every few epochs</li>
            <li>Monitor disk space on volume with <code>df -h</code></li>
            <li>Use <code>tee</code> to save logs while viewing them: <code>python train.py | tee log.txt</code></li>
            <li>Test with small batch first to verify setup before full run</li>
          </ul>
        </div>
      </section>

      <!-- Section 7 -->
      <section id="section-7" class="content-section">
        <h2>7. Downloading Results</h2>
        
        <h3>Preferred Method: Use the Volume</h3>
        <ol>
          <li>Save outputs to attached volume</li>
          <li>Detach volume from GPU VM</li>
          <li>Attach to low-cost download VM or staging VM</li>
          <li>Download via rsync to your laptop</li>
        </ol>

        <div class="tip-box">
          <h4>üí° Why This Method?</h4>
          <p class="mb-0">Avoids keeping expensive GPU VM running just for downloads. A cheap CPU VM costs much less per hour.</p>
        </div>

        <h3>Download</h3>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># From your laptop - using rsync
rsync -avz -P --checksum -e "ssh -i /path/to/ssh_private_key" ubuntu@gpu-vm-ip:/mnt/user_volume/results/ ./local_results/

# Or using scp (for smaller files)
scp -r ubuntu@gpu-vm-ip:/mnt/user_volume/results ./local_results</code></pre>
        </div>
      </section>

      <!-- Section 8 -->
      <section id="section-8" class="content-section">
        <h2>8. Storage Management: Root, Ephemeral & Persistent Volumes</h2>
        
        <h3>Storage Types & Best Use Cases</h3>
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th>Type</th>
              <th>Persistence</th>
              <th>Best Use</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Root Disk (OS)</strong></td>
              <td>While instance exists</td>
              <td>OS + small configs</td>
            </tr>
            <tr>
              <td><strong>Ephemeral Disk</strong></td>
              <td>Deleted on termination</td>
              <td>Temporary scratch, fast I/O</td>
            </tr>
            <tr>
              <td><strong>Persistent Volume</strong></td>
              <td>Survives VM deletion</td>
              <td>Datasets, outputs, sharing</td>
            </tr>
          </tbody>
        </table>

        <h3>Volume Operations</h3>
        <ol>
          <li><code><strong><big>UI:</big></strong></code><strong>Volumes ‚Üí Create Volume</strong> (specify size)</li>
          <li><code><strong><big>UI:</big></strong></code><strong>Attach to VM</strong></li>
          <li>Mount in VM (see commands below)</li>
          <li>Save persistent data into the mounted folder</li>
          <li>Download persistent data from the mounted folder to your local machine</li>
          <li>Unmount in VM (see commands below)</li>
          <li><code><strong><big>UI:</big></strong></code><strong>Detach</strong></li>
          <li><code><strong><big>UI:</big></strong></code><strong>Delete</strong></li>
        </ol>

        <h3>Getting Your Volume Device Path from Hyperstack</h3>
        <p>When you attach a volume to your VM via the UI, Hyperstack provides a device path that you'll need for mounting:</p>

        <div class="example-box">
          <h4>üìã Example Device Path from Hyperstack</h4>
          <code style="background: #f8f9fa; padding: 0.5rem; display: block; border-radius: 4px;">/dev/disk/by-id/virtio-c72d3b45-dc19-48ec-9</code>
          <p class="mt-2 mb-0"><strong>Important:</strong> This path is displayed in the VM details panel after attaching a volume. Look for the <strong>üìã Copy Device</strong> button to easily copy it.</p>
        </div>

        <div class="tip-box">
          <h4>üí° How to Find Your Device Path</h4>
          <ol class="mb-0">
            <li>In the UI, navigate to your VM details after attaching a volume</li>
            <li>Find the "Attached Volumes" section</li>
            <li>Click the <strong>üìã Copy Device</strong> button to copy the device path</li>
            <li>Use this exact path in the mount commands below</li>
          </ol>
        </div>
  
        <h3>Linux Commands for Volume Management</h3>
        
        <h4>List Disks</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># You have several options, with different details, pick your favorite one
# Displays block devices, including volumes, in a hierarchical format
lsblk
# Filesystem metadata details
blkid
# List disk IDs (find your volume here)
ls -l /dev/disk/by-id/</code></pre>
        </div>

        <div class="tip-box">
          <h4>üí° Verifying Your Volume</h4>
          <p class="mb-0">If you copied the device path from the UI (e.g., <code>/dev/disk/by-id/virtio-c72d3b45...</code>), verify it exists with:<br>
          <!-- <code>ls -l /dev/disk/by-id/virtio-*</code></p> -->
          <pre><code class="language-bash"># Look for virtio devices 
ls -l /dev/disk/by-id/virtio-*</code></pre>
        </div>

        <h4>Format (example: /dev/sdb)</h4>

        <div class="warning-box">
          <h4>‚ö†Ô∏è Critical: Formating a Volume will erase all the data it contains.</h4>
          <p class="mb-0">So, do it only when you just created the Volume, and it is empty. <br> You can also format it later if you want to change the filesystem format, but make sure the data is backed up somewhere else.</p>
          <p class="mb-0">Replace <code>/dev/disk/by-id/virtio-xxxxx</code> below with the actual device path you copied from the UI. Using the wrong device could destroy data!</p>
        </div>

        <p><strong>Method 1: Using the device path from UI (Recommended)</strong></p>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Replace this with YOUR actual device path from the UI
DEVICE="/dev/disk/by-id/virtio-c72d3b45-dc19-48ec-9"

# Verify the device exists
ls -l $DEVICE

# Format to ext4 
sudo mkfs.ext4 -F ${DEVICE}

# Create mountpoint and mount 
sudo mkdir -p /mnt/user_volume 
# Change the ownership of the folder
sudo chown ubuntu:ubuntu /mnt/user_volume/
# Mount the volume to the created folder
sudo mount ${DEVICE} /mnt/user_volume 

# Verify
df -h /mnt/user_volume 
ls -la /mnt/user_volume 
        </code></pre>
        </div>

        <p class="mt-3"><strong>Method 2: Using traditional device names</strong> (only if you're certain that your volume is mounted to /dev/sdb1)</p>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Only use this if you're certain about the device name
sudo mkfs.ext4 -F /dev/sdb1
sudo mkdir -p /mnt/user_volume
sudo mount /dev/sdb1 /mnt/user_volume
          </code></pre>
        </div>

        <div class="example-box">
          <h4>üìã Complete Example with Real Device Path</h4>
          <div class="command-block">
            <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code class="language-bash"># Step 1: Copy device path from UI, e.g.:
# /dev/disk/by-id/virtio-c72d3b45-dc19-48ec-9 

# Step 2: Store it in a variable for easy use 
DEVICE="/dev/disk/by-id/virtio-c72d3b45-dc19-48ec-9"

# Step 3: Format and mount 
sudo mkfs.ext4 -F ${DEVICE} 
sudo mkdir -p /mnt/user_volume
# Change the ownership of the folder
sudo chown ubuntu:ubuntu /mnt/user_volume/
# Mount the volume to the created folder
sudo mount ${DEVICE} /mnt/user_volume

# Step 4: Verify it worked 
df -h | grep user_volume
# Output should show: /dev/sdb1  1.0T  100M  900G  1% /mnt/user_volume
            </code></pre>
          </div>
        </div>

        <h4>Auto-mount on Boot (Optional)</h4>
        <p>By default, volumes mounted using the <code>mount</code> command are not automatically reattached after a reboot or VM restore. To ensure the volume is mounted automatically at boot, add an entry to your <code>/etc/fstab</code> file.</p>
       <div class="workflow-step">
          <div class="workflow-number">1</div>
          <div>
            <strong>Identify the UUID of the volume</strong>
            <div class="command-block mt-2">
              <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
              <pre><code class="language-bash"># Get UUID of your volume partition
# Replace with your device path
sudo blkid /dev/disk/by-id/virtio-c72d3b45-dc19-48ec-9

# Or if using traditional naming
sudo blkid /dev/sdb1

# Output example:
# /dev/sdb1: UUID="a1b2c3d4-e5f6-7890-abcd-ef1234567890" TYPE="ext4"
            </code></pre>
            </div>
          </div>
        </div>

        <div class="workflow-step">
          <div class="workflow-number">2</div>
          <div>
            <strong>Open the /etc/fstab file</strong>
            <div class="command-block mt-2">
              <code class="language-bash">sudo nano /etc/fstab</code>
            </div>
          </div>
        </div>

        <div class="workflow-step">
          <div class="workflow-number">3</div>
          <div>
            <strong>Add a line to auto-mount the volume</strong>
            <div class="command-block mt-2">
              <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
              <pre><code class="language-bash"># Add this line, replacing UUID with your actual UUID <br>
UUID=a1b2c3d4-e5f6-7890-abcd-ef1234567890 /mnt/user_volume ext4 defaults,nofail 0 2</code></pre>
            </div>
          </div>
        </div>

        <div class="warning-box">
          <h4>‚ö†Ô∏è Important: Use the "nofail" Option</h4>
          <p class="mb-2">If the volume isn't always attached to your VM, you <strong>must</strong> add the <code>nofail</code> option to your <code>/etc/fstab</code> entry.</p>
          <p class="mb-0"><strong>Without <code>nofail</code>:</strong> Your VM may fail to boot if the volume is not attached.<br>
          <strong>With <code>nofail</code>:</strong> The system will boot normally even if the volume is missing.</p>
        </div>

        <div class="tip-box">
          <h4>üí° Why Use UUID Instead of Device Paths?</h4>
          <p class="mb-0">Device paths like <code>/dev/sdb1</code> can change between reboots. Using UUID in <code>/etc/fstab</code> ensures your volume always mounts correctly, even if device names change.</p>
        </div>

        <h4>Test Your fstab Entry</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Unmount the volume first
sudo umount /mnt/user_volume

# Test mounting all entries in fstab
sudo mount -a

# Verify it mounted correctly
df -h | grep user_volume

# If successful, the volume will now mount automatically on boot!</code></pre>
        </div>

        <h4>Safe Unmount</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Check what's using the mount
lsof /mnt/user_volume

# Sync and Unmount
sync
sudo umount /mnt/user_volume</code></pre>
        </div>

        <div class="warning-box">
          <h4>‚ö†Ô∏è Critical: Safe Detach Practice</h4>
          <ol class="mb-0">
            <li>Run <code>sync</code> to flush writes</li>
            <li>Stop processes using mountpoint</li>
            <li>Run <code>sudo umount /mnt/user_volume</code></li>
            <li><strong>Only then</strong> detach in UI</li>
            <li>Never detach a mounted volume - it can cause data loss!</li>
          </ol>
        </div>

      </section>

      <!-- Section 9 -->
      <section id="section-9" class="content-section">
        <h2>9. VM Lifecycle: Delete, Hibernate, Restore</h2>
        
        <h3>Understanding VM States</h3>
        <div class="row">
          <div class="col-md-4 mb-3">
            <div class="card border-success">
              <div class="card-body">
                <h5 class="card-title">‚ñ∂Ô∏è Running</h5>
                <p class="card-text small">VM has been created or restored and is up and running (so it is billed for compute). Don't forget to hibernate it or delete it when it is idle.</p>
                <p class="mb-0"><span class="badge bg-success">Use for: Running your simulations</span></p>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card border-info">
              <div class="card-body">
                <h5 class="card-title">üí§ Hibernate</h5>
                <p class="card-text small">Memory image saved. Resumption to same state without a full boot-up sequence. 
                  All hardware resources are deallocated and not billed. Billing continues for the root disk data and the public IP address.
                  Billing details: root disk:~ $0.07 per GB/month ; IP address: ~$5/month</p>
                <p class="mb-0"><span class="badge bg-info">Use for: Quick resume</span></p>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card border-danger">
              <div class="card-body">
                <h5 class="card-title">üóëÔ∏è Deleted</h5>
                <p class="card-text small">VM, root disk and ephemeral disks destroyed. Attached volumes are detached and can be re-attached to other VM(s).</p>
                <p class="mb-0"><span class="badge bg-danger">Use for: Finished work</span></p>
              </div>
            </div>
          </div>
        </div>

        <h3>When to Use Each</h3>
        <ul>
          <li><strong>Running:</strong> When actively using the VM for computationally intensive simulation(s)</li>
          <li><strong>Hibernate:</strong> Preserve running state (rarely used for long ML runs). Useful for iterative development workflow. I.e. when you want to pause your simulation, work on your code/app offline for a while, and then resume your simulation with your updated code/app</li>
          <li><strong>Delete:</strong> Project finished and you have fetched all your useful data/results (and saved them either into a Volume, or into your local machine).</li>
        </ul>

        <div class="warning-box">
          <h4>‚ö†Ô∏è Before Deleting a VM</h4>
          <ul class="mb-0">
            <li>Copy all important data from ephemeral storage to <code>/mnt/user_volume/</code></li>
            <li>Verify results are saved to <code>/mnt/user_volume/</code></li>
            <li>Unmount and detach volumes you want to keep</li>
          </ul>
        </div>

        <h3>Practical Steps (UI)</h3>
        <ul>
          <li><strong>To save money:</strong> Hibernate the GPU VM between runs</li>
          <li><strong>To restore:</strong> Restore Hibernated VM from UI</li>
          <li><strong>To cleanup:</strong> Delete VM when experiment is over (after backing up volumes)</li>
        </ul>
      </section>

      <!-- Section 10 -->
      <section id="section-10" class="content-section">
        <h2>10. Budget Management & Efficiency Tips</h2>
        
        <h3>High-Impact Cost Savers</h3>
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">üí∞ Before Running</h5>
                <ul class="small mb-0">
                  <li>Use staging VM for uploads</li>
                  <li>Choose right-sized GPU flavor</li>
                  <li>Share volumes across team</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="card-title">üí∞ During & After</h5>
                <ul class="small mb-0">
                  <li>Hibernate idle VMs immediately</li>
                  <li>Delete VMs when done</li>
                  <li>Compress data before transfer (if you use <code>rsync</code> command, this is simply achieved with the option <code>-z</code>)</li>
                  <li>Monitor credit usage daily/weekly</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="tip-box">
          <h4>üí° Best Practices</h4>
          <ul class="mb-0">
            <li>Review team spending daily/weekly</li>
            <li>Archive old datasets to cheaper storage or even better, to local machine</li>
            <li>Use containers to reduce setup time</li>
            <li>Test with small batches on smaller GPU VMs before full runs</li>
          </ul>
        </div>
      </section>

      <!-- Section 11 -->
      <section id="section-11" class="content-section">
        <h2>11. Best Practices & Troubleshooting</h2>
        
        <h3>Reproducibility</h3>
        <ul>
          <li>Save environment specs: <code>conda env export > environment.yml</code></li>
          <li>Use container images for experiments</li>
          <li>Version control your code with Git</li>
          <li>Document module loading sequence</li>
        </ul>

        <h3>Security</h3>
        <ul>
          <li><strong>Use SSH keys, avoid passwords:</strong> Upload your public key to your VMs by using "Import SSH Key" feature</li>
          <li><strong>Protect your private keys:</strong> Never share or upload private keys (files without .pub extension)</li>
          <li><strong>Key rotation:</strong> Regularly update SSH keys, especially when team members leave</li>
          <li>Don't store secrets in images or code repositories</li>
          <li>Use secure tokens for JupyterLab</li>
          <li><strong>Audit VM access:</strong> Periodically review who has SSH access to your VMs</li>
        </ul>

        <h3>Troubleshooting Commands</h3>
        
        <h4>GPU Driver Issues</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Check kernel modules and driver
lsmod | grep -i nvidia
nvidia-smi -q | less

# Check CUDA version
nvcc --version</code></pre>
        </div>

        <h4>Disk Problems</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Check disk health
sudo smartctl -a /dev/sda

# Check filesystem
sudo fsck -n /dev/sdb1</code></pre>
        </div>

        <h4>System Logs</h4>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Check recent logs
dmesg | tail -n 50
journalctl -xe
journalctl -u docker.service --since "1 hour ago"</code></pre>
        </div>

        <h3>Multi-GPU Control</h3>
        <div class="command-block">
          <button class="btn btn-sm btn-light copy-btn" onclick="copyCode(this)">Copy</button>
          <pre><code class="language-bash"># Use specific GPUs
export CUDA_VISIBLE_DEVICES=0,1
python train.py  # uses GPU 0 and 1 only

# For NCCL (multi-node training)
export NCCL_SOCKET_IFNAME=eth0</code></pre>
        </div>
      </section>

      <!-- Quick Reference -->
      <section id="quick-ref" class="content-section">
        <h2>Quick Reference</h2>
        
        <h3>Essential Commands Cheat Sheet</h3>
        
        <div class="row">
          <div class="col-md-6">
            <h4>Module Management</h4>
            <div class="command-block">
              <pre><code class="language-bash">module avail
module load anaconda3/2024.02-1
module load ml_dl_gpu_base_all
module list</code></pre>
            </div>

            <h4>Volume Management</h4>
            <div class="command-block">
              <pre><code class="language-bash">lsblk
sudo mount /dev/sdb1 /mnt/user_volume
sync
sudo umount /mnt/user_volume</code></pre>
            </div>

            <h4>Data Transfer</h4>
            <div class="command-block">
              <pre><code class="language-bash">rsync -avz -P --checksum -e "ssh -i /path/to/ssh_private_key" ./local_results/ ubuntu@gpu-vm-ip:/mnt/user_volume/
scp -r ./local_results ubuntu@vm:/mnt/user_volume/</code></pre>
            </div>
          </div>

          <div class="col-md-6">
            <h4>Monitoring</h4>
            <div class="command-block">
              <pre><code class="language-bash">nvidia-smi
watch -n 2 nvidia-smi
htop
df -h /mnt/user_volume</code></pre>
            </div>

            <h4>Session Management</h4>
            <div class="command-block">
              <pre><code class="language-bash">tmux new -s training
# Ctrl-B then D to detach
tmux attach -t training
tmux ls</code></pre>
            </div>

            <h4>GPU Verification</h4>
            <div class="command-block">
              <pre><code class="language-bash">nvidia-smi
python -c "import torch; print(torch.cuda.is_available())"</code></pre>
            </div>
          </div>
        </div>

        <h3>Pre-Run Checklist</h3>
        <ul class="checklist">
          <li>Your SSH key has been imported into the GPU VM</li>
          <li>Dataset + code is ready</li>
          <li>Verify <code>nvidia-smi</code> works</li>
          <li>Data stored on volume (not ephemeral)</li>
          <li>Job running in <code>tmux</code></li>
          <li>Checkpoints enabled in code</li>
          <li>Tested with small batch first</li>
        </ul>

        <h3>Example: Complete Workflow</h3>
        <div class="example-box">
          <h4>Aysha's Deep Learning Project</h4>
          <ol>
            <li>Aysha generates her SSH key pair</li>
            <li>Creates 1TB persistent volume in UI</li>
            <li>Creates cheap staging VM</li>
            <li>Imports her SSH public key into the staging VM</li>
            <li>Attaches 1TB volume to the staging VM</li>
            <li>In UI, copies device path: <code>/dev/disk/by-id/virtio-abc123...</code></li>
            <li>SSH to staging VM, formats and mounts volume using device path</li>
            <li>Uploads dataset via <code>rsync</code> to staging VM</li>
            <li>Safely unmounts: <code>sync && sudo umount /mnt/user_volume</code></li>
            <li>Detaches volume in UI</li>
            <li>Creates powerful GPU VM (H100)</li>
            <li>Imports her SSH public key into this powerful VM</li>
            <li>Attaches 1TB volume to powerful GPU VM</li>
            <li>SSH to powerful GPU VM: <code>ssh -i private_key.pem ubuntu@gpu-vm-ip</code></li>
            <li>Gets device path from UI and mounts: <code>sudo mount ${DEVICE} /mnt/user_volume</code></li>
            <li>Loads modules: <code>module load anaconda3 ml_dl_gpu_base_all</code></li>
            <li>Starts training in tmux: <code>python train.py --data /mnt/user_volume</code></li>
            <li>Monitors with: <code>watch -n 2 nvidia-smi</code></li>
            <li>Results saved to <code>/mnt/user_volume/results/</code></li>
            <li>Safely unmounts, detaches volume, attaches to staging VM</li>
            <li>Delete/Hibernate powerful GPU VM to save credits</li>
            <li>Downloads: <code>rsync -avz -P --checksum -e "ssh -i /path/to/ssh_private_key" ubuntu@staging_ip:/mnt/user_volume/results/ ./</code></li>
            <li>Delete/Hibernate staging VM to save credits</li>
          </ol>
        </div>
      </section>

    </div>
  </div>
</div>

<script>
function copyCode(button) {
  const codeBlock = button.nextElementSibling;
  const text = codeBlock.textContent;
  
  navigator.clipboard.writeText(text).then(() => {
    const originalText = button.textContent;
    button.textContent = '‚úì Copied!';
    button.classList.add('btn-success');
    button.classList.remove('btn-light');
    
    setTimeout(() => {
      button.textContent = 'Copy';
      button.classList.remove('btn-success');
      button.classList.add('btn-light');
    }, 2000);
  }).catch(err => {
    console.error('Failed to copy:', err);
    button.textContent = '‚úó Failed';
  });
}

// Smooth scroll for navigation
document.querySelectorAll('.sidebar .nav-link').forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    const targetId = this.getAttribute('href');
    const targetSection = document.querySelector(targetId);
    
    // Update active state
    document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
    this.classList.add('active');
    
    // Smooth scroll
    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
});

// Update active nav on scroll
window.addEventListener('scroll', () => {
  let current = '';
  document.querySelectorAll('.content-section').forEach(section => {
    const sectionTop = section.offsetTop;
    const sectionHeight = section.clientHeight;
    if (pageYOffset >= sectionTop - 100) {
      current = section.getAttribute('id');
    }
  });
  
  document.querySelectorAll('.sidebar .nav-link').forEach(link => {
    link.classList.remove('active');
    if (link.getAttribute('href') === `#${current}`) {
      link.classList.add('active');
    }
  });
});
</script>

</body>
</html>
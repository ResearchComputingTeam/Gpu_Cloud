<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Existing VMs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <link href="css/style.css" rel="stylesheet">
</head>

<body>
<div class="card p-3 mb-3">
    <h5>Handle existing VMs</h5>
    <!-- <div class="mb-3" id="projectLabel">
        <label for="vm_name" class="form-label">VM Name</label>
        <input type="text" id="vm_name" class="form-control" placeholder="Enter the name of the VM you want to manage">
    </div> -->

    <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 class="mb-0">‚öôÔ∏è Manage VMs</h2>
          <small>Project: <code id="projectIdDisplay">Loading...</code></small>
        </div>
        <button class="btn btn-light btn-sm" onclick="goBackToProjectPanel()">‚Üê Back</button>
      </div>
    </div>

    <div class="mb-3">
        <label for="projectId" class="form-label"><strong>VM Name</strong></label>
        <input type="text" 
               id="vmName" 
               class="form-control" 
               placeholder="VM Name"
               onkeypress="handleEnter(event)">
    </div>
    <!-- Refresh Button -->
    <button class="btn btn-primary mb-3" onclick="loadVms()">
        <span id="refreshBtn-text">üîÑ Refresh VMs</span>
        <span id="refreshBtn-spinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
    </button>

    <!-- VMs List -->
    <div id="vmsList">
        <div class="empty-state">
            <div class="empty-state-icon">‚è≥</div>
            <p>Loading VMs...</p>
        </div>
    </div>

    <div class="d-grid gap-2">
        <!-- <button class="btn btn-primary" onclick="updateStatus('simulation_running')">‚ñ∂Ô∏è Run Simulation</button>
        <button class="btn btn-warning" onclick="updateStatus('simulation_paused')">‚è∏Ô∏è Pause Simulation</button>
        <button class="btn btn-success" onclick="updateStatus('simulation_running')">üîÅ Resume Simulation</button>
        <button class="btn btn-danger" onclick="updateStatus('simulation_complete')">üõë Stop Simulation</button>
        <button class="btn btn-info" onclick="updateStatus('finalized')">üí∞ Finalize & Show Credits</button> -->
        <!-- <div class="d-flex justify-content-between"> -->
        <div class="button-group">
            <button class="btn btn-warning" onclick="trigger('pause_simulation')">‚è∏Ô∏è Hibernate GPU VM</button>
            <button class="btn btn-danger" onclick="trigger('stop_simulation')">üõë Delete GPU VM</button>
        </div>
        <button class="btn btn-secondary" onclick="trigger('check_status')">üîç Check Status</button>
    </div>

    <div id="progress-panel" class="mt-3">
        <h5>Progress Panel</h5>
        <div id="progress-content" class="alert alert-info" role="alert">
        Ready, waiting for user action.
        </div>
    </div>

    <div id="loading-spinner" class="text-center my-3" style="display:none;">
        <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="card mt-3" id="markdown-panel" style="max-height: 400px; overflow-y: auto;">
        <div class="card-header text-white">
        <strong>Details</strong>
        </div>
        <div class="card-body" id="markdown-content">
        <!-- Rendered markdown HTML goes here -->
        </div>
    </div>

    <div id="status-message"></div>

    <div class="mt-4">
        <h6>History</h6>
        <div id="responseHistoryList" class="list-group" style="max-height:100px; overflow-y:auto;">
            <!-- History items will be injected here -->
        </div>
    </div>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const projectId = urlParams.get("project_id");
document.getElementById("projectLabel").textContent = "Project ID: " + projectId;

// Example: load data via API (pseudo)
// fetch(`/api/vms?project_id=${projectId}`).then(...)

function goBack() {
    window.location.href = `project-panel.html?project_id=${projectId}`;
}
</script>

<script>

function loadVms() {
  const projectId = getProjectIdFromUrl();
  // ... specific logic ...
}


</script>

<script src="utils.js"></script>
</body>

</html>